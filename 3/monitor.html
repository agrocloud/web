<!DOCTYPE html>
<!-- saved from url=(0060)https://getbootstrap.com/docs/4.0/examples/starter-template/ -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="https://getbootstrap.com/docs/4.0/assets/img/favicons/favicon.ico">

    <title>Agrocloud</title>

    <link rel="canonical" href="https://getbootstrap.com/docs/4.0/examples/starter-template/">

    <!-- Bootstrap core CSS -->
    <link href="./Starter Template for Bootstrap_files/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="./Starter Template for Bootstrap_files/starter-template.css" rel="stylesheet">
  </head>

  <body>

    <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
      <a class="navbar-brand" href="https://getbootstrap.com/docs/4.0/examples/starter-template/#">Agrocloud</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarsExampleDefault">
        <ul class="navbar-nav mr-auto">


          
          <li class="nav-item active">
            <a class="nav-link" href="/caudalimetros.html">Monitor<span class="sr-only">(current)</span></a>
          </li>



          <li class="nav-item">
            <a class="nav-link" href="centrales.html">Centrales</a>
          </li>


           <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Menu
        </a>


        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
          <a class="dropdown-item" href="#">Agregar Central</a>
          <a class="dropdown-item" href="#">Agregar Usuario</a>
          <div class="dropdown-divider"></div>
          <!--
          <a class="dropdown-item" href="#">Ver Canales</a>
        -->
        </div>


      </li>
      
    <li class="nav-item">
            <a class="nav-link" href="/index.html">Cerrar Sesi√≥n</a>
          </li>
        </ul>
        <form class="form-inline my-2 my-lg-0">
          <input class="form-control mr-sm-2" type="text" placeholder="Search" aria-label="Search">
          <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
        </form>
      </div>
    </nav>

    <main role="main" class="container">

      <div class="starter-template">
    <br></br>
      </div>

    </main><!-- /.container -->

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="./Starter Template for Bootstrap_files/jquery-3.2.1.slim.min.js.descarga" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery-slim.min.js"><\/script>')</script>
    <script src="./Starter Template for Bootstrap_files/popper.min.js.descarga"></script>
    <script src="./Starter Template for Bootstrap_files/bootstrap.min.js.descarga"></script>
   



<script src=" https://cdnjs.com/libraries/Chart.js"></script>



  <style>



body, html {
    height: 80%;
}

/* The hero image */
.hero-image {
  /* Use "linear-gradient" to add a darken background effect to the image (photographer.jpg). This will make the text easier to read */
  background-image: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url("/images/banner.jpg");

  /* Set a specific height */
  height: 50%;

  /* Position and center the image to scale nicely on all screens */
  background-position: center;
  background-repeat: no-repeat;
  background-size: cover;
  position: relative;
}

/* Place text in the middle of the image */
.hero-text {
  text-align: center;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: white;
}


</style>





<script type="text/javascript">
/*  
// Set the date we're counting down to
var countDownDate = new Date("Aug 12, 2021 15:37:25").getTime();

// Update the count down every 1 second
var x = setInterval(function() {

  // Get today's date and time
  var now = new Date().getTime();
    
  // Find the distance between now and the count down date
  var distance = countDownDate - now;
    
  // Time calculations for days, hours, minutes and seconds
  var days = Math.floor(distance / (1000 * 60 * 60 * 24));
  var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
  var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
  var seconds = Math.floor((distance % (1000 * 60)) / 1000);
    
  // Output the result in an element with id="demo"
  document.getElementById("demo").innerHTML = days + "d " + hours + ":"
  + minutes + ":" + seconds;
    
  // If the count down is over, write some text 
  if (distance < 0) {
    clearInterval(x);
    document.getElementById("demo").innerHTML = "EXPIRED";
  }
}, 1000);

*/
</script>




<div class="hero-image">
  <div class="hero-text">
  
  </div>
</div>




<body id="cuerpo">
<link rel="stylesheet" href="./simplepicker_ Material Inspired Date &amp; Time Picker Example_files/simplepicker.css">



  <style>
  body { font-family: 'Roboto'; }
    .event-log {
      font-family: consolas, Monaco, monospace;
      margin: 10px 5px;
      line-height: 2;
      border: 1px solid #4c4c4c;
      height: auto;
      width: 90%;
      padding: 2px 6px;
      color: #4c4c4c;
      white-space: pre;
    }
  </style>
</head>

<body>




  

  <script src="./simplepicker_ Material Inspired Date &amp; Time Picker Example_files/simplepicker.js.descarga"></script>




  <script>
    let simplepicker = new SimplePicker({
      zIndex: 10
    });


    const $button = document.querySelector('button');
    const $eventLog = document.querySelector('.event-log');


    $button.addEventListener('click', (e) => {
     // simplepicker.open();
    });

    // $eventLog.innerHTML += '\n\n';
    simplepicker.on('submit', (date, readableDate) => {
     // $eventLog.innerHTML += readableDate + '\n';


var div = document.getElementById('eventos');

//div.innerHTML += readableDate + '\n\n';
//load(); 

insertar(readableDate);


   console.log(readableDate)


    });


    simplepicker.on('close', (date) => {
      //$eventLog.innerHTML += 'Picker Closed'  + '\n';


    });
  </script>




<div class="simplepicker-wrapper" style="z-index: 10;">
  <div class="simpilepicker-date-picker">
    <div class="simplepicker-day-header">Sunday</div>
      <div class="simplepicker-date-section">
        <div class="simplepicker-month-and-year">July 2021</div>
        <div class="simplepicker-date">25th</div>
        <div class="simplepicker-select-pane">
          <button class="simplepicker-icon simplepicker-icon-calender active" title="Select date from calender!"></button>
          <div class="simplepicker-time simplepicker-fade">12:00 PM</div>
          <button class="simplepicker-icon simplepicker-icon-time" title="Select time"></button>
        </div>
      </div>
      <div class="simplepicker-picker-section">
        <div class="simplepicker-calender-section">
          <div class="simplepicker-month-switcher simplepicker-select-pane">
            <button class="simplepicker-icon simplepicker-icon-previous"></button>
            <div class="simplepicker-selected-date">July 2021</div>
            <button class="simplepicker-icon simplepicker-icon-next"></button>
          </div>
          <div class="simplepicker-calender">
            <table>
              <thead>
                <tr><th>Sun</th><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th></tr>
              </thead>
              <tbody>
                <tr><td data-empty=""></td><td data-empty=""></td><td data-empty=""></td><td data-empty=""></td><td>1</td><td>2</td><td>3</td></tr><tr><td>4</td><td>5</td><td>6</td><td>7</td><td>8</td><td>9</td><td>10</td></tr><tr><td>11</td><td>12</td><td>13</td><td>14</td><td>15</td><td>16</td><td>17</td></tr><tr><td>18</td><td>19</td><td>20</td><td>21</td><td>22</td><td>23</td><td>24</td></tr><tr><td class="active">25</td><td>26</td><td>27</td><td>28</td><td>29</td><td>30</td><td>31</td></tr><tr><td data-empty=""></td><td data-empty=""></td><td data-empty=""></td><td data-empty=""></td><td data-empty=""></td><td data-empty=""></td><td data-empty=""></td></tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="simplepicker-time-section">
          <input type="time" value="12:00" autofocus="false">
        </div>
      </div>
      <div class="simplepicker-bottom-part">
        <button class="simplepicker-cancel-btn simplepicker-btn" title="Cancel">Cancel</button>
        <button class="simplepicker-ok-btn simplepicker-btn" title="OK">OK</button>
      </div>
  </div>
</div>



</body>

</html>














<link href="css/bootstrap.css" type="text/css" rel="stylesheet" media="all">


    


<script src="js/jquery-1.11.1.min.js"></script> 


<script src="js/gauge.min.js">  </script> 



<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>



<style>
body {font-family: Arial, Helvetica, sans-serif;}

/* The Modal (background) */
.modal {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 1; /* Sit on top */
  padding-top: 100px; /* Location of the box */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

/* Modal Content */
.modal-content {
  position: relative;
  background-color: #fefefe;
  margin: auto;
  padding: 0;
  border: 1px solid #888;
  width: 80%;
  box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
  -webkit-animation-name: animatetop;
  -webkit-animation-duration: 0.4s;
  animation-name: animatetop;
  animation-duration: 0.4s
}

/* Add Animation */
@-webkit-keyframes animatetop {
  from {top:-300px; opacity:0} 
  to {top:0; opacity:1}
}

@keyframes animatetop {
  from {top:-300px; opacity:0}
  to {top:0; opacity:1}
}

/* The Close Button */
.close {
  color: white;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: #000;
  text-decoration: none;
  cursor: pointer;
}

.modal-header {
  padding: 2px 16px;
  background-color: #5cb85c;
  color: white;
}

.modal-body {padding: 2px 16px;}

.modal-footer {
  padding: 2px 16px;
  background-color: #5cb85c;
  color: white;
}
</style>



<style>


.Div {
  border: 5px outset black;
  background-color: whitesmoke;
}

.* {
  box-sizing: border-box;
}

/* Float four columns side by side */
.column {
  float: left;
  width: 25%;
  padding: 0 5px;
}

.row {margin: 0 -5px;}

/* Clear floats after the columns */
.row:after {
  content: "";
  display: table;
  clear: both;
}

/* Responsive columns */
@media screen and (max-width: 600px) {
  .column {
    width: 100%;
    display: block;
    margin-bottom: 10px;
  }
}

/* Style the counter cards */
.card {
  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
  padding: 16px;
  text-align: center;
  background-color: #444;
  color: white;
}

.fa {font-size:50px;}

</style>


<style>
#sliderLabel {
    border: 1px solid #a2a2a2;
    -webkit-border-radius: 3px;
    -moz-border-radius: 3px;
    border-radius: 3px;
    cursor: pointer;
    display: block;
    height: 30px;
    overflow: hidden;
    position: relative;
    width: 100px;
    display: inline-block;
}

#sliderLabel input {
    display: none;
}

#sliderLabel input:checked + #slider {
    left: 0px;
}

#slider {
    left: -50px;
    position: absolute;
    top: 0px;
    -webkit-transition: left .25s ease-out;
    -moz-transition: left .25s ease-out;
    -o-transition: left .25s ease-out;
    -ms-transition: left .25s ease-out;
    transition: left .25s ease-out;
}

#sliderOn,
#sliderBlock,
#sliderOff {
    display: block;
    font-family: arial, verdana, sans-serif;
    font-weight: bold;
    height: 30px;
    line-height: 30px;
    position: absolute;
    text-align: center;
    top: 0px;
}

#sliderOn {
    background: #3269aa;
    background: -webkit-linear-gradient(top, #3269aa 0%, #82b3f4 100%);
    background: -moz-linear-gradient(top, #3269aa 0%, #82b3f4 100%);
    background: -o-linear-gradient(top, #3269aa 0%, #82b3f4 100%);
    background: -ms-linear-gradient(top, #3269aa 0%, #82b3f4 100%);
    background: linear-gradient(top, #3269aa 0%, #82b3f4 100%);
    color: white;
    left: 0px;
    width: 54px;
}

#sliderBlock {
    background: #d9d9d8;
    background: -webkit-linear-gradient(top, #d9d9d8 0%, #fcfcfc 100%);
    background: -moz-linear-gradient(top, #d9d9d8 0%, #fcfcfc 100%);
    background: -o-linear-gradient(top, #d9d9d8 0%, #fcfcfc 100%);
    background: -ms-linear-gradient(top, #d9d9d8 0%, #fcfcfc 100%);
    background: linear-gradient(top, #d9d9d8 0%, #fcfcfc 100%);
    border: 1px solid #a2a2a2;
    -webkit-border-radius: 3px;
    -moz-border-radius: 3px;
    border-radius: 3px;
    height: 28px;
    left: 50px;
    width: 50px;
}

#sliderOff {
    background: #f2f3f2;
    background: -webkit-linear-gradient(top, #8b8c8b 0%, #f2f3f2 50%);
    background: -moz-linear-gradient(top, #8b8c8b 0%, #f2f3f2 50%);
    background: -o-linear-gradient(top, #8b8c8b 0%, #f2f3f2 50%);
    background: -ms-linear-gradient(top, #8b8c8b 0%, #f2f3f2 50%);
    background: linear-gradient(top, #8b8c8b 0%, #f2f3f2 50%);
    color: #8b8b8b;
    left: 96px;
    width: 54px;
}
</style>





<script type="text/javascript">

$( document ).ready(function() {




  $.ajax({
    url:'/nodos',
    method:'POST',
    datatype:"JSON",
    contentType: "application/json",
    beforeSend: function(data){
      console.log('Enviando...',data)
    },


  }).done(function(respuesta){

    const numero = respuesta.length;
    let nombres = respuesta;
    const canales=[];

    console.log('Respuesta recibida:',respuesta)
    console.log(respuesta)
    console.log(respuesta.length)
 
   //console.log(numero);

   

 var x=[];




// Set the date we're counting down to

 var countDownDate=[];
 countDownDate[0] = new Date("Aug 12, 2021 15:45:25").getTime();
  countDownDate[1] = new Date("Aug 15, 2022 15:37:25").getTime();
   countDownDate[2] = new Date("Aug 15, 2024 15:37:25").getTime();
    countDownDate[3] = new Date("Aug 15, 2021 15:37:25").getTime();
    countDownDate[4] = new Date("Aug 15, 2021 15:37:25").getTime();
    countDownDate[5] = new Date("Aug 15, 2021 15:37:25").getTime();
    countDownDate[6] = new Date("Aug 15, 2021 15:37:25").getTime();
      countDownDate[7] = new Date("Aug 15, 2021 15:37:25").getTime();
    


var countDownDate2=[];
 countDownDate2[0] = new Date("Aug 25, 2021 15:45:25").getTime();
  countDownDate2[1] = new Date("Aug 15, 2022 15:37:25").getTime();
   countDownDate2[2] = new Date("Aug 28, 2024 15:37:25").getTime();
    countDownDate2[3] = new Date("Aug 15, 2021 15:37:25").getTime();
       countDownDate2[4] = new Date("Aug 15, 2021 15:37:25").getTime();
    countDownDate2[5] = new Date("Aug 15, 2021 15:37:25").getTime();
    countDownDate2[6] = new Date("Aug 15, 2021 15:37:25").getTime();
      countDownDate[7] = new Date("Aug 15, 2021 15:37:25").getTime();





// Update the count down every 1 second
 x[0] = setInterval(function() {

  for ( var item = 0; item < numero; item++) {

  // Get today's date and time
  var now = new Date().getTime();
    
  // Find the distance between now and the count down date
  var distance = countDownDate[item]- now;
  var distance2 = countDownDate2[item]- now;
    
  // Time calculations for days, hours, minutes and seconds
  var days = Math.floor(distance / (1000 * 60 * 60 * 24));
  var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
  var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
  var seconds = Math.floor((distance % (1000 * 60)) / 1000);


    var days2 = Math.floor(distance2 / (1000 * 60 * 60 * 24));
  var hours2 = Math.floor((distance2 % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
  var minutes2 = Math.floor((distance2 % (1000 * 60 * 60)) / (1000 * 60));
  var seconds2 = Math.floor((distance2 % (1000 * 60)) / 1000);
    
  // Output the result in an element with id="demo"
  var tome=days + "d " + hours + ":"
  + minutes + ":" + seconds;

  // Output the result in an element with id="demo"
  var tome2=days2 + "d " + hours2 + ":"
  + minutes2 + ":" + seconds2;


var textnode = document.createTextNode(tome);

var textnode2 = document.createTextNode(tome2);



var select = document.getElementById("demo"+respuesta[item].id);

var select2 = document.getElementById("demo2"+respuesta[item].id);



   var detalles = document.createElement("button");
   detalles.setAttribute("class","")
   detalles.setAttribute("id",item)
   detalles.setAttribute("onclick","abrir3(this.id)")


   var textoCelda3 = document.createTextNode("Imagen");
detalles.appendChild(textnode)


var detalles2 = document.createElement("button");
   detalles2.setAttribute("class","")
   detalles2.setAttribute("id",item)
   detalles2.setAttribute("onclick","abrir3(this.id)")


   var textoCelda4 = document.createTextNode("Imagen");
detalles2.appendChild(textnode2)




while (select.firstChild) {
  select.removeChild(select.firstChild);
}


while (select2.firstChild) {
  select2.removeChild(select2.firstChild);
}




  document.getElementById("demo"+respuesta[item].id).appendChild(detalles);
  document.getElementById("demo2"+respuesta[item].id).appendChild(detalles2);

  // If the count down is over, write some text 
  if (distance < 0) {

while (select.firstChild) {
  select.removeChild(select.firstChild);
}


var textnode = document.createTextNode("Programar");
   var select = document.getElementById("demo"+respuesta[item].id);



   var detalles = document.createElement("button");
   detalles.setAttribute("class","")
   detalles.setAttribute("id",item)
   detalles.setAttribute("onclick","abrir3(this.id)")




  
detalles.appendChild(textnode)
    document.getElementById("demo"+respuesta[item].id).appendChild(detalles);
  }

    if (distance2 < 0) {

while (select2.firstChild) {
  select2.removeChild(select2.firstChild);
}


var textnode = document.createTextNode("Programar");
   var select2 = document.getElementById("demo2"+respuesta[item].id);



   var detalles2 = document.createElement("button");
   detalles2.setAttribute("class","")
   detalles2.setAttribute("id",item)
   detalles2.setAttribute("onclick","abrir3(this.id)")




  
detalles2.appendChild(textnode)
    document.getElementById("demo2"+respuesta[item].id).appendChild(detalles2);
  }


}

}, 1000);




for ( var item = 0; item < numero ; item++) {

copia(respuesta[item]);

//bot√≥n 1
var newContent1 = document.createTextNode("ON");
var newContent2 = document.createTextNode("OFF");

 var check= document.createElement("input");
            check.setAttribute('type', "checkbox")
            check.setAttribute('id', ":"+respuesta[item].id+"/A")
             check.setAttribute('onchange', "doalert(this)")

            var label=document.createElement("label")
            label.setAttribute('id' , "sliderLabel")


             var spa=document.createElement("span")
               var spa2=document.createElement("span")


               spa2.setAttribute('id',"sliderOn")
               spa2.appendChild(newContent1)


                 var spa3=document.createElement("span")
                 spa3.setAttribute('id',"sliderOff")
                 spa3.appendChild(newContent2)
                 var spa4=document.createElement("span")
                 spa4.setAttribute('id',"sliderBlock")


             spa.setAttribute('id',"slider")
             spa.appendChild(spa2)
             spa.appendChild(spa3)
             spa.appendChild(spa4)

             label.appendChild(check)
             label.appendChild(spa)

           

//boton2

var newContent3 = document.createTextNode("ON");
var newContent4 = document.createTextNode("OFF");

 var check2= document.createElement("input");
            check2.setAttribute('type', "checkbox")
            check2.setAttribute('id', respuesta[item].id+"/B")
             check2.setAttribute('onchange', "doalert(this)")


            var label2=document.createElement("label")
            label2.setAttribute('id' , "sliderLabel")


             var spo=document.createElement("span")
               var spo2=document.createElement("span")


               spo2.setAttribute('id',"sliderOn")
               spo2.appendChild(newContent3)


                 var spo3=document.createElement("span")
                 spo3.setAttribute('id',"sliderOff")
                 spo3.appendChild(newContent4)
                 var spo4=document.createElement("span")
                 spo4.setAttribute('id',"sliderBlock")


             spo.setAttribute('id',"slider")
             spo.appendChild(spo2)
             spo.appendChild(spo3)
             spo.appendChild(spo4)

             label2.appendChild(check2)
             label2.appendChild(spo)



            var canv = document.createElement("canvas");
            
            var division= document.createElement("div");
            division.setAttribute("style" , "float: left")



           

            var salto= document.createElement("br")
            var porte= document.createElement("h1")


            var newContent3 = document.createTextNode(respuesta[item].id);
            porte.appendChild(newContent3)
            



            document.body.appendChild(division)

               
            canv.setAttribute('width', 500);
            canv.setAttribute('height', 500);

            canv.setAttribute('id', item);
            //document.body.appendChild(canv);

            canales.push(nombres[item].id)
            //console.log(canales);
           





 // Obtener la referencia del elemento body
  var body = document.getElementsByTagName("body")[0];

  // Crea un elemento <table> y un elemento <tbody>
  var tabla   = document.createElement("table");
  var tblBody = document.createElement("tbody");

  // Crea las celdas
  for (var i = 0; i < 9; i++) {
    // Crea las hileras de la tabla
    var hilera = document.createElement("tr");

    for (var j = 0; j < 1; j++) {
      // Crea un elemento <td> y un nodo de texto, haz que el nodo de
      // texto sea el contenido de <td>, ubica el elemento <td> al final
      // de la hilera de la tabla
      var celda = document.createElement("td");
     // var textoCelda = document.createTextNode("celda en la hilera "+i+", columna "+j);
      //celda.appendChild(textoCelda);
      hilera.appendChild(celda);


     if(i==0)
     {

     var textoCelda = document.createTextNode(respuesta[item].id);
     celda.appendChild(textoCelda);
     
     }


if(i==1)
     {

     var textoCelda = document.createTextNode("");
     celda.appendChild(textoCelda);
      celda.appendChild(canv)
      celda.appendChild(textoCelda);

     }


if(i==2)
     {

        var textoCelda2 = document.createTextNode("Accionador A");
     celda.appendChild(textoCelda2);


     

     }


if(i==3)
     {

   



   
     celda.appendChild(label)


     }


if(i==4)
     {

/*
        var textoCelda3 = document.createTextNode("Accionador B");
     celda.appendChild(textoCelda3);

     var dev = document.createElement("div")
        dev.setAttribute("id","secondTenthsExample")
        var dav=document.createElement("div");
        dav.setAttribute("class","values");
        dev.appendChild(dav)
        celda.appendChild(dev);

*/


  
    var pe=document.createElement("div");
     pe.setAttribute("id","demo"+respuesta[item].id);
     pe.setAttribute("float","rigth");

     
     celda.appendChild(pe);
     
  


  

     
  

     }


if(i==5)
     {
 var textoCelda2 = document.createTextNode("Accionador B");
     celda.appendChild(textoCelda2);
  
     




     }

if(i==6)
     {
celda.appendChild(label2)
    
     }

     if(i==7)
     {


    var pe=document.createElement("div");
     pe.setAttribute("id","demo2"+respuesta[item].id);
     pe.setAttribute("float","rigth");

     
     celda.appendChild(pe);
     
   

     }
     if(i==8)
     {


var detalles = document.createElement("button");
   detalles.setAttribute("class","button button1")
   detalles.setAttribute("id",item)
   detalles.setAttribute("onclick","abrir1(this.id)")


   var textoCelda3 = document.createTextNode("Detalles");
detalles.appendChild(textoCelda3)



   celda.appendChild(detalles)
     
   var detalles = document.createElement("button");
   detalles.setAttribute("class","button button1")
   detalles.setAttribute("id",item)
   detalles.setAttribute("onclick","abrir2(this.id)")



   var textoCelda3 = document.createTextNode("Lecturas");
detalles.appendChild(textoCelda3)



   celda.appendChild(detalles)






   var detalles = document.createElement("button");
   detalles.setAttribute("class","button button1")
   detalles.setAttribute("id",item)
   detalles.setAttribute("onclick","abrir1(this.id)")


   var textoCelda3 = document.createTextNode("Imagen");
detalles.appendChild(textoCelda3)



   celda.appendChild(detalles)



   var detalles = document.createElement("button");
   detalles.setAttribute("class","button button1")
   detalles.setAttribute("id",item)
   detalles.setAttribute("onclick","abrir1(this.id)")


   var textoCelda3 = document.createTextNode("Historial");
detalles.appendChild(textoCelda3)



   celda.appendChild(detalles)





     }


    }

    // agrega la hilera al final de la tabla (al final del elemento tblbody)
    tblBody.appendChild(hilera);
  }



  // posiciona el <tbody> debajo del elemento <table>
  tabla.appendChild(tblBody);
  // appends <table> into <body>
  body.appendChild(tabla);
  // modifica el atributo "border" de la tabla y lo fija a "2";
  tabla.setAttribute("border", "2");



 


    //division.appendChild(label);
    division.appendChild(tabla)

        }



   comu(canales,numero);


}).fail(function(err){
    console.log(err)
    

  }

    )
//console.log(canales);

 alert("Descargando informaci√≥n del usuario")


});







function comu(canales,numero)
{
const clientId = 'mqttjs_' + Math.random().toString(16).substr(2, 8)

const options = {
  keepalive: 60,
  clientId: clientId,
  protocolId: 'MQTT',
  protocolVersion: 4,
  clean: true,
  reconnectPeriod: 1000,
  connectTimeout: 30 * 1000,
  will: {
    topic: 'WillMsg',
    payload: 'Connection Closed abnormally..!',
    qos: 0,
    retain: false
  },
}


const host = 'ws://192.168.43.42:9001' 
let canales2=[];
canales2=canales;


console.log('Connecting mqtt client')
const client = mqtt.connect(host, options)

client.on('error', (err) => {
  console.log('Connection error: ', err)
  //client.end()
})

client.on('reconnect', () => {
  console.log('Reconnecting...')
})



client.on('connect', () => {
  console.log('Client connected:' + clientId)
  // Subscribe

  
})

console.log(canales);
;


var gauges=[];

for ( var item = 0; item < numero ; item++) {

 client.subscribe(canales[item], { qos: 0 })
          
gauges[item] = new RadialGauge({ renderTo: item.toString() ,width: 420,
    height: 350, id:item}).draw()


        }


/*
nodo2 = new RadialGauge({ renderTo: "1" ,width: 400,
    height: 400, id:item}).draw()
*/


client.on('message', (topic, message, packet) => {
  //console.log('Received Message: ' + message.toString() + '\nOn topic: ' + topic)
  
var msn=message.toString();
console.log(msn);
console.log(msn.length)

//console.log(canales[0])
if(message.length<6)
{
for ( var item = 0; item < numero ; item++) {

 if(topic.toString()==canales[item])

 	gauges[item].value = parseInt(msn)

        }
}



})


}

</script>

<script>




function doalert(checkboxElem,canales,numero) {


let canales2=[];
canales2=canales;


const clientId = 'mqttjs_' + Math.random().toString(16).substr(2, 8)


const host = 'ws://192.168.43.42:9001'

const options = {
  keepalive: 60,
  clientId: clientId,
  protocolId: 'MQTT',
  protocolVersion: 4,
  clean: true,
  reconnectPeriod: 1000,
  connectTimeout: 30 * 1000,
  will: {
    topic: 'WillMsg',
    payload: 'Connection Closed abnormally..!',
    qos: 0,
    retain: false
  },
}

for ( var item = 0; item < numero ; item++) {

 client.subscribe(canales[item], { qos: 0 })


        }


console.log('Connecting mqtt client')
const client = mqtt.connect(host, options)

client.on('error', (err) => {
  console.log('Connection error: ', err)
  //client.end()
})

client.on('reconnect', () => {
  console.log('Reconnecting...')
})



client.on('connect', () => {
  console.log('Client connected:' + clientId)
  // Subscribe

  
})


client.on('message', (topic, message, packet) => {
  //console.log('Received Message: ' + message.toString() + '\nOn topic: ' + topic)
  

})


  if (checkboxElem.checked) {



  var strong = checkboxElem.id.substring(
    checkboxElem.id.lastIndexOf(":") + 1, 
    checkboxElem.id.lastIndexOf("/")
);

mySubString=strong+"control";
 // alert(mySubString)

    client.publish(mySubString,checkboxElem.id+"#ON;")
    console.log(mySubString,checkboxElem.id+"#ON;")
   
  } else {
    //alert (checkboxElem.id+"/OFF");

  var strong = checkboxElem.id.substring(
    checkboxElem.id.lastIndexOf(":") + 1, 
    checkboxElem.id.lastIndexOf("/")
);
  mySubString=strong+"control";
  //alert(mySubString)
 client.publish(mySubString,checkboxElem.id+"#OFF;")
 console.log(mySubString,checkboxElem.id+"#OFF;")
    
    
  }
}

</script>




<style>
.button {
  border: none;
  color: white;
  padding: 10px 10px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 14px;
  margin: 4px 2px;
  cursor: pointer;


}

.button1 {background-color: #4CAF50;} /* Green */

</style>

</body>
</html>



<!--
<canvas id="gauge1"></canvas>
-->


<script>
/*
new RadialGauge({
    renderTo: 'gauge1',
    width: 400,
    height: 400,
    units: 'Km/h',
    title: false,
    value: 0,
    minValue: 0,
    maxValue: 220,
    majorTicks: [
        '0','20','40','60','80','100','120','140','160','180','200','220'
    ],
    minorTicks: 2,
    strokeTicks: false,
    highlights: [
        { from: 0, to: 50, color: 'rgba(0,255,0,.15)' },
        { from: 50, to: 100, color: 'rgba(255,255,0,.15)' },
        { from: 100, to: 150, color: 'rgba(255,30,0,.25)' },
        { from: 150, to: 200, color: 'rgba(255,0,225,.25)' },
        { from: 200, to: 220, color: 'rgba(0,0,255,.25)' }
    ],
    colorPlate: '#222',
    colorMajorTicks: '#f5f5f5',
    colorMinorTicks: '#ddd',
    colorTitle: '#fff',
    colorUnits: '#ccc',
    colorNumbers: '#eee',
    colorNeedle: 'rgba(240, 128, 128, 1)',
    colorNeedleEnd: 'rgba(255, 160, 122, .9)',
    valueBox: true,
    animationRule: 'bounce',
    animationDuration: 500
}).draw();
*/

/*new RadialGauge({ renderTo: "gauge3",width: 400,
    height: 400, }).draw();
      
*/





/*
if (!window.addEventListener) {
    window.addEventListener = function(evt, listener) {
        window.attachEvent('on' + evt, listener);
    };
}
if (!Array.prototype.forEach) {
    Array.prototype.forEach = function(cb) {
        var i = 0, s = this.length;
        for (; i < s; i++) {
            cb && cb(this[i], i, this);
        }
    }
}
*/



</script>
<!--
<input type="button" value="Genera una tabla" onclick="genera_tabla()">
-->


<style>
table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
}
th, td {
  padding: 5px;
  text-align: left;
}
</style>


<style>


.Div {
  border: 5px outset black;
  background-color: whitesmoke;
}

.* {
  box-sizing: border-box;
}

/* Float four columns side by side */
.column {
  float: left;
  width: 25%;
  padding: 0 5px;
}

.row {margin: 0 -5px;}

/* Clear floats after the columns */
.row:after {
  content: "";
  display: table;
  clear: both;
}

/* Responsive columns */
@media screen and (max-width: 600px) {
  .column {
    width: 100%;
    display: block;
    margin-bottom: 10px;
  }
}

/* Style the counter cards */
.card {
  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
  padding: 16px;
  text-align: center;
  background-color: #444;
  color: white;
}

.fa {font-size:50px;}

</style>



<script src="src/bootstrap-input-spinner.js"></script>
<script>
    $("input[type='number']").inputSpinner();
</script>


<script src="bootstrap-input-spinner.js"></script>


<link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.18.3/dist/bootstrap-table.min.css">

<script src="https://unpkg.com/bootstrap-table@1.18.3/dist/bootstrap-table.min.js"></script>
       




<script>



function genera() {

  /*
    <table class="table table-hover">
    <thead>
      <tr>
        <th>Firstname</th>
        <th>Lastname</th>
        <th>Email</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>John</td>
        <td>Doe</td>
        <td>john@example.com</td>
      </tr>
    
    
    </tbody>
  </table>
*/


var alarmas=[];
//var text1 = document.createTextNode('Accionador');
var text2 = document.createTextNode('Evento de tiempo');
var text3 = document.createTextNode('Acci√≥n');




  // Obtener la referencia del elemento body
var select = document.getElementById('ventana')

  // Crea un elemento <table> y un elemento <tbody>
  var table   = document.createElement("table");
  //table.setAttribute("class","table table-hover")
  table.setAttribute("id","table")
 // table.setAttribute("style","td.fit")

var head=document.createElement("thead");
var column=document.createElement("tr");
//var celda1=document.createElement("th");
//celda1.appendChild(text1);
//celda1.setAttribute("data-field","accionador")
var celda2=document.createElement("th");
celda2.appendChild(text2);
celda2.setAttribute("data-field","timer")
var celda3=document.createElement("th");
celda3.appendChild(text3);
celda3.setAttribute("data-field","accion")

//column.appendChild(celda1);
column.appendChild(celda2);

column.appendChild(celda3);

head.appendChild(column);


var body=document.createElement("tbody");



var column2=document.createElement("tr");
var cell1=document.createElement("td")
cell1.setAttribute("width","10%")


var cell2=document.createElement("td")
cell2.setAttribute("width","10%")



var cell3=document.createElement("td")
cell3.setAttribute("width","10%")





body.appendChild(column2);

table.appendChild(head);
table.appendChild(body);

select.appendChild(table);
}











function genera_tabla() {

var alarmas=[];


console.log(alarmas.length)

  // Obtener la referencia del elemento body
var select = document.getElementById('ventana')

  // Crea un elemento <table> y un elemento <tbody>
  var tabla   = document.createElement("table");
  tabla.setAttribute("id","sucesos")
  //tabla.setAttribute("class","table table-hover")




// Create an empty <thead> element and add it to the table:
var header = tabla.createTHead();
header.setAttribute("bgcolor","")

// Create an empty <tr> element and add it to the first position of <thead>:
var row = header.insertRow(0);    

// Insert a new cell (<td>) at the first position of the "new" <tr> element:
var cell = row.insertCell();
var cell2 = row.insertCell();
var cell3 = row.insertCell();

var testo = document.createTextNode('Accionador');
cell.appendChild(testo);

var testo2 = document.createTextNode('Fecha/Hora');
cell2.appendChild(testo2);

var testo3 = document.createTextNode('Acci√≥n');
cell3.appendChild(testo3);





  var tblBody = document.createElement("tbody");

  // Crea las celdas
  for (var i = 0; i < alarmas.length; i++) {
    // Crea las hileras de la tabla
    var hilera = document.createElement("tr");
    //hilera.setAttribute("clickable-row","click")

    for (var j = 0; j < 1; j++) {
      // Crea un elemento <td> y un nodo de texto, haz que el nodo de
      // texto sea el contenido de <td>, ubica el elemento <td> al final
      // de la hilera de la tabla
      var celda = document.createElement("td");
      var textoCelda = document.createTextNode(alarmas[i]);
      celda.appendChild(textoCelda);
      hilera.appendChild(celda);
    }

    // agrega la hilera al final de la tabla (al final del elemento tblbody)
    tblBody.appendChild(hilera);
  }

  // posiciona el <tbody> debajo del elemento <table>
  tabla.appendChild(tblBody);
  // appends <table> into <body>
  select.appendChild(tabla);
  // modifica el atributo "border" de la tabla y lo fija a "2";
  tabla.setAttribute("border", "2");
}


function genera_tabla2() {

var triggers=[];


console.log(triggers.length)

  // Obtener la referencia del elemento body
var select = document.getElementById('ventana')

  // Crea un elemento <table> y un elemento <tbody>
  var tabla   = document.createElement("table");
  //tabla.setAttribute("class","table table-hover")
  tabla.setAttribute("id","tigre")



// Create an empty <thead> element and add it to the table:
var header = tabla.createTHead();
header.setAttribute("bgcolor","")

// Create an empty <tr> element and add it to the first position of <thead>:
var row = header.insertRow(0);    

// Insert a new cell (<td>) at the first position of the "new" <tr> element:
var cell = row.insertCell();
var cell2 = row.insertCell();
var cell3 = row.insertCell();
var cell4 = row.insertCell()

var testo = document.createTextNode('Sensor');
cell.appendChild(testo);

var testo2 = document.createTextNode('Condici√≥n');
cell2.appendChild(testo2);

var testo3 = document.createTextNode('Valor');
cell3.appendChild(testo3);

var testo4 = document.createTextNode('Acci√≥n');
cell4.appendChild(testo4);





  var tblBody = document.createElement("tbody");

  // Crea las celdas
  for (var i = 0; i < triggers.length; i++) {
    // Crea las hileras de la tabla
    var hilera = document.createElement("tr");
    hilera.setAttribute("class","clickable-row")


    for (var j = 0; j < 1; j++) {
      // Crea un elemento <td> y un nodo de texto, haz que el nodo de
      // texto sea el contenido de <td>, ubica el elemento <td> al final
      // de la hilera de la tabla
      var celda = document.createElement("td");
      var textoCelda = document.createTextNode(triggers[i]);
      celda.appendChild(textoCelda);
      hilera.appendChild(celda);
    }

    // agrega la hilera al final de la tabla (al final del elemento tblbody)
    tblBody.appendChild(hilera);
  }

  // posiciona el <tbody> debajo del elemento <table>
  tabla.appendChild(tblBody);
  // appends <table> into <body>
  select.appendChild(tabla);
  // modifica el atributo "border" de la tabla y lo fija a "2";
  tabla.setAttribute("border", "2");
}


var fechas=[];
           
function insertar(readableDate) {

 // Find a <table> element with id="myTable":
var table = document.getElementById("table");

// Create an empty <tr> element and add it to the 1st position of the table:
var row = table.insertRow();

// Insert new cells (<td> elements) at the 1st and 2nd position of the "new" <tr> element:
//var cell1 = row.insertCell();
var cell2 = row.insertCell();
var cell3 = row.insertCell();







/*
<select id="cars" name="cars">
    <option value="volvo">Volvo</option>
    <option value="saab">Saab</option>
    <option value="fiat">Fiat</option>
    <option value="audi">Audi</option>
  </select>
*/
/*
var selector=document.createElement("select");
selector.setAttribute("id","cars");
selector.setAttribute("name","cars");


var option1=document.createElement("option");
option1.setAttribute("value","A");
var A = document.createTextNode("A");
option1.appendChild(A);



var option2=document.createElement("option");
option2.setAttribute("value","B")
var B = document.createTextNode("B");
option2.appendChild(B);




selector.appendChild(option1);
selector.appendChild(option2);
*/



var selector2=document.createElement("select");
selector2.setAttribute("id",readableDate);
selector2.setAttribute("name","cars2");


var opt1=document.createElement("option");
opt1.setAttribute("value","ON");
var A1 = document.createTextNode("ON");
opt1.appendChild(A1);



var opt2=document.createElement("option");
opt2.setAttribute("value","OFF")
var B2 = document.createTextNode("OFF");
opt2.appendChild(B2);

var opt3=document.createElement("option");
opt3.setAttribute("value","Borrar")
var C3 = document.createTextNode("borrar");
opt3.appendChild(C3);





selector2.appendChild(opt1);
selector2.appendChild(opt2);
selector2.appendChild(opt3);





//cell1.setAttribute("width","10%")
// Add some text to the new cells:
//cell1.appendChild(selector);

cell2.innerHTML = readableDate.toString();
cell3.appendChild(selector2);











fechas.push(readableDate.toString());

}


function insertar2() {
var select = document.getElementById('ventana');
 // Find a <table> element with id="myTable":
var table = document.getElementById("tigre");

// Create an empty <tr> element and add it to the 1st position of the table:
var row = table.insertRow();

// Insert new cells (<td> elements) at the 1st and 2nd position of the "new" <tr> element:
var cell1 = row.insertCell(0);
var cell2 = row.insertCell(1);
var cell3 = row.insertCell(2);
var cell4 = row.insertCell(3);




var spinner=document.createElement("input");
spinner.setAttribute("type","number");
spinner.setAttribute("value","4.5");
spinner.setAttribute("data-decimals","2");
spinner.setAttribute("min","-20");
spinner.setAttribute("max","50");
spinner.setAttribute("step","0.1");
//select.appendChild(spinner);
// Add some text to the new cells:
//cell1.appendChild(spinner);
//cell2.appendChild(spinner);
cell3.appendChild(spinner);

var selector2=document.createElement("select");
selector2.setAttribute("id","cars2");
selector2.setAttribute("name","cars2");


var opt1=document.createElement("option");
opt1.setAttribute("value","A");
var A1 = document.createTextNode("<");
opt1.appendChild(A1);



var opt2=document.createElement("option");
opt2.setAttribute("value","B")
var B2 = document.createTextNode(">");
opt2.appendChild(B2);

var opt3=document.createElement("option");
opt3.setAttribute("value","B")
var C3 = document.createTextNode("=");
opt3.appendChild(C3);


selector2.appendChild(opt1);
selector2.appendChild(opt2);
selector2.appendChild(opt3);

cell2.appendChild(selector2);




var sel=document.createElement("select");
sel.setAttribute("id","cars2");
sel.setAttribute("name","cars2");


var opt1=document.createElement("option");
opt1.setAttribute("value","A");
var A1 = document.createTextNode("ON");
opt1.appendChild(A1);



var opt2=document.createElement("option");
opt2.setAttribute("value","B")
var B2 = document.createTextNode("OFF");
opt2.appendChild(B2);

var opt3=document.createElement("option");
opt3.setAttribute("value","B")
var C3 = document.createTextNode("Borrar");
opt3.appendChild(C3);


sel.appendChild(opt1);
sel.appendChild(opt2);
sel.appendChild(opt3);

cell4.appendChild(sel);


var sol=document.createElement("select");
sol.setAttribute("id","cars2");
sol.setAttribute("name","cars2");


var opt1=document.createElement("option");
opt1.setAttribute("value","A");
var A1 = document.createTextNode("t¬∞");
opt1.appendChild(A1);



var opt2=document.createElement("option");
opt2.setAttribute("value","B")
var B2 = document.createTextNode("-");
opt2.appendChild(B2);

var opt3=document.createElement("option");
opt3.setAttribute("value","B")
var C3 = document.createTextNode("-");
opt3.appendChild(C3);


sol.appendChild(opt1);
sol.appendChild(opt2);
sol.appendChild(opt3);

cell1.appendChild(sol);



}


    </script>


<script>



var table = $('#table').DataTable(); 

       $('#table').bootstrapTable({});
            function load(){
                var data = [{
                        accionador: 1,
                        timer: 'Item 1',
                        accion: '$1'
                    }, {
                        accionador: 2,
                        timer: 'Item 2',
                        accion: '$4'
                    }]; 
                $('#table').bootstrapTable("load", data);
            }


</script>



<!-- The Modal -->
<div id="myModal" class="modal">

  <!-- Modal content -->
  <div class="modal-content">
    <div class="modal-header">
      <span class="close">&times;</span>
      <h2>Especificaciones</h2>
    </div>
    <div class="modal-body" id="ventana">
     

<div class="event-log">Event logs:<br>Picker Closed
</div>

    </div>


<style>
table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
}
th, td {
  padding: 5px;
  text-align: left;
}
</style>



    <div class="modal-footer">
      <h3>Modal Footer</h3>
    </div>
  </div>

</body>


</html>



<style>
.slidecontainer {
  width: 100%;
}

.slider {
  -webkit-appearance: none;
  width: 100%;
  height: 25px;
  background: #d3d3d3;
  outline: none;
  opacity: 0.7;
  -webkit-transition: .2s;
  transition: opacity .2s;
}

.slider:hover {
  opacity: 1;
}

.slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 25px;
  height: 25px;
  background: #04AA6D;
  cursor: pointer;
}

.slider::-moz-range-thumb {
  width: 25px;
  height: 25px;
  background: #04AA6D;
  cursor: pointer;
}
</style>

<script>
var hola=createElement("div");
var ventana = document.getElementById("ventana");
hola.appendChild(ventana);
</script>


<script type="text/javascript">
  



</script>
<script src="./src/bootstrap-input-spinner.js"></script>
<script>
// Get the modal
var modal = document.getElementById("myModal");

var respuesta2 = [];

function copia(respuesta)
{

respuesta2.push(respuesta)
console.log(respuesta2);

}


/*
function disp(id)
{

console.log(id)
console.log(respuesta2)


document.getElementById("nom").innerHTML = respuesta2[id].id;

document.getElementById("sector").innerHTML = respuesta2[id].Sector;

document.getElementById("estatus").innerHTML = respuesta2[id].Estado;


abrir();


}
*/


function abrir1(id)
{

var select = document.getElementById('ventana');

while (select.firstChild) {
  select.removeChild(select.firstChild);
}



/*

  <select id="cars" name="cars">
    <option value="volvo">Volvo</option>
    <option value="saab">Saab</option>
    <option value="fiat">Fiat</option>
    <option value="audi">Audi</option>
  </select>
*/


modal.style.display = "block";

}






var select = document.getElementById('ventana');
var texto= document.createElement("h1");

var texto3= document.createTextNode("alsjdlkjsd");

texto.appendChild(texto3);

select.appendChild(texto);







function abrir2(id)
{

var lecturas=[];
var fechas=[];

 $.ajax({
    url: "/nodo1",
    method:'POST',
    datatype:"JSON",
    contentType: "application/json",
    beforeSend: function(data){
      console.log('Enviando...',data)
    },


  }).done(function(respuesta){



    console.log('Respuesta recibida:',respuesta)
    console.log(respuesta)
   console.log(respuesta.length)
   const numero = respuesta.length;
   let nombres = respuesta;
   console.log(numero);



console.log(respuesta);
console.log(respuesta);
console.log(respuesta);
console.log(respuesta);
console.log(respuesta);
console.log(respuesta);


for ( var item = 0; item < numero ; item++) {


lecturas.push(respuesta[item].lectura)
fechas.push(item)


        }

console.log(lecturas);



}).fail(function(err){
    console.log(err)
    

  }

    )




var select = document.getElementById('ventana');

while (select.firstChild) {
  select.removeChild(select.firstChild);
}

const clientId = 'mqttjs_' + Math.random().toString(16).substr(2, 8)


const host = 'ws://192.168.43.42:9001'

const options = {
  keepalive: 60,
  clientId: clientId,
  protocolId: 'MQTT',
  protocolVersion: 4,
  clean: true,
  reconnectPeriod: 1000,
  connectTimeout: 30 * 1000,
  will: {
    topic: 'WillMsg',
    payload: 'Connection Closed abnormally..!',
    qos: 0,
    retain: false
  },
}


console.log('Connecting mqtt client')
const client = mqtt.connect(host, options)

client.on('error', (err) => {
  console.log('Connection error: ', err)
  //client.end()
})

client.on('reconnect', () => {
  console.log('Reconnecting...')
})



client.on('connect', () => {
  console.log('Client connected:' + clientId)
 client.subscribe("nodo1", { qos: 0 })

  
})



client.on('message', (topic, message, packet) => {
  //console.log('Received Message: ' + message.toString() + '\nOn topic: ' + topic)

var msn=message.toString();
//console.log("modlemqtt"+msn)
 myChart.update();
lecturas.push(msn)
fechas.push("hola")
console.log(lecturas);
//console.log(fechas)

  myChart.update();


})


var chart = document.createElement("canvas")

chart.setAttribute("id","myChart")

select.appendChild(chart)

var slider= document.createElement("input");
slider.setAttribute("type","range");
slider.setAttribute("min","1");
slider.setAttribute("max","100");
slider.setAttribute("value","50");
slider.setAttribute("class","slider");
slider.setAttribute("id","myRange");

var text = document.createTextNode("N¬∞ muestras");
select.appendChild(text);



var pe = document.createElement("p");

var text2 = document.createTextNode("Configuraci√≥n");
pe.appendChild(text2);
pe.setAttribute("id","demo");
select.appendChild(pe);
select.appendChild(slider)



   
var detalles = document.createElement("button");
detalles.setAttribute("class","button button1")
detalles.setAttribute("id","hola")
detalles.setAttribute("onclick","limpiar(myChart)")


var textoCelda3 = document.createTextNode("Limpiar");
detalles.appendChild(textoCelda3)

select.appendChild(detalles)




var slider = document.getElementById("myRange");
var output = document.getElementById("demo");





output.innerHTML = slider.value;

slider.oninput = function() {
  output.innerHTML = this.value;
}




 alert("Base de datos descargada")

var ctx = document.getElementById('myChart');
var myChart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: fechas,
        datasets: [{
            label: 'Real Time',
            data: lecturas,
            backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(255, 159, 64, 0.2)'
            ],
            borderColor: [
                'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)'
            ],
            borderWidth: 1
        }]
    },
    options: {
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});



modal.style.display = "block";





this.limpiar =function()
{


 $.ajax({
    url: "/limpiar",
    method:'POST',
    datatype:"JSON",
    contentType: "application/json",
    beforeSend: function(data){
      console.log('Enviando...',data)
    },


  }).done(function(respuesta){

    console.log('Respuesta recibida:',respuesta)
    console.log(respuesta)
   console.log(respuesta.length)
   const numero = respuesta.length;
   let nombres = respuesta;
   console.log(numero);



console.log(respuesta);


console.log(lecturas);



}).fail(function(err){
    console.log(err)
    

  }

    )

for (var i = lecturas.length; i > 0; i--) {
 lecturas.pop();
  fechas.pop();
}

console.log(lecturas)

}



















}


function abrir3(id)
{

var select = document.getElementById('ventana');



while (select.firstChild) {
  select.removeChild(select.firstChild);
}

var evento=document.createElement("input");
evento.setAttribute("type","button");
evento.setAttribute("value","A√±adir Evento de Tiempo");
evento.setAttribute("onclick","simplepicker.open();")

var trigger=document.createElement("input");


trigger.setAttribute("type","button");
trigger.setAttribute("value","A√±adir Evento de Sensor");
trigger.setAttribute("onclick","insertar2();")


var guardar=document.createElement("input");


guardar.setAttribute("type","button");
guardar.setAttribute("value","Guardar");
guardar.setAttribute("onclick","obtener();")

var dov= document.createElement("div");
dov.setAttribute("id","eventos");



select.appendChild(dov);

let table = document.createElement('table');
let thead = document.createElement('thead');
let tbody = document.createElement('tbody');

table.appendChild(thead);
table.appendChild(tbody);

// Adding the entire table to the body tag
document.getElementById('ventana').appendChild(table);








//genera_tabla();
modal.style.display = "block";


/*
genera_tabla();






*/
genera();

select.appendChild(evento)
genera_tabla2()
select.appendChild(trigger)
select.appendChild(guardar)







}


function obtener()
{

var alarms=[];
console.log("hola");
//gets table
var oTable = document.getElementById('table');


//gets rows of table
var rowLength = oTable.rows.length;
 

//var oCells = oTable.rows.item(2).cells;


//var cellLength = oCells.length;


//var hola=oCells.item(0).textContent


 //console.log(cellLength)
//console.log(rowLength)
 //console.log(hola);
var o=0;
for (var i = 2; i < rowLength; i++) {
var oCells = oTable.rows.item(i).cells;
alarms[o]=oCells.item(0).textContent
o=o+1;
}

console.log(alarms[0])
console.log(alarms[1])
console.log(alarms[2])
console.log(alarms[3])

 getConfirmation()

}



// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];


// When the user clicks on <span> (x), close the modal
span.onclick = function() {
  modal.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
}
</script>



<script src="js/jquery-1.11.1.min.js"></script>


   <script src="js/bootstrap.js"></script>


  

   <script type = "text/javascript">
         <!--


var alarmas=[];

            function getConfirmation() {
              
 for ( var item = 0; item < fechas.length; item++) {
var select = document.getElementById(fechas[item]);
var value = select.options[select.selectedIndex].value;

var tiempo=select.id.substring(select.id.length-4,select.id.length)
              
              alarmas.push("2")
              alert(alarmas[item]);

              $.ajax({
    url:'/timers',
    method:'POST',
    data: {Timer: alarmas[item]
        
         },

    beforeSend: function(data){
      console.log('Enviando...',data)
    },
  }).done(function(respuesta){

    console.log('Respuesta recibida:',respuesta)
    console.log(respuesta)

}).fail(function(err){
    console.log(err)
    
  }

    )
       }



  















       alarmas=[];
       fechas=[];
     }


         //-->
      </script>



</script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js" crossorigin="anonymous"></script>
        <script src="assets/demo/chart-area-demo.js"></script>
        <script src="assets/demo/chart-bar-demo.js"></script>



<script>




</script>


